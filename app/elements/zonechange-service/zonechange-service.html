<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<dom-module id="zonechange-service">
  <template>
   <iron-ajax
            method="post"
            id="getzonechangenameajax"
            url="{{getzonechangenameurl}}"
            params="{{getzonechangenameparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="getzonechangenameResponse"
            debounce-duration="300"
            >
        </iron-ajax>
         <iron-ajax
            method="post"
            id="getzonechangestudetailajax"
            url="{{getzonechangestudetailurl}}"
            params="{{getzonechangestudetailparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="getzonechangestudetailResponse"
            debounce-duration="300"
            >
        </iron-ajax>
        <iron-ajax
            method="post"
            id="fetchstuzonedetailajax"
            url="{{fetchstuzonedetailurl}}"
            params="{{fetchstuzonedetailparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="fetchstuzonedetailResponse"
            debounce-duration="300"
            >
        </iron-ajax>
         <iron-ajax
          method="post"
          id="zonechangeparentdetailajax"
          url="{{zonechangeparentnameurl}}"
          params="{{zonechangeparentnameparam}}"
          handle-as="json"
          content-type="application/json"
          on-response="zonechangeparentnameResponse"
          debounce-duration="300"
        >
        </iron-ajax>
         <iron-ajax
            method="post"
            id="zonechangeclassajax"
            url="{{zonechangeclassurl}}"
            params="{{zonechangeclassparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="zonechangeclassResponse"
            debounce-duration="300"
            >
        </iron-ajax>
         <iron-ajax
            method="post"
            id="getchangezoneajax"
            url="{{getchangezoneurl}}"
            params="{{getchangezoneparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="getchangezoneResponse"
            debounce-duration="300"
            >
        </iron-ajax>
         <iron-ajax
            method="post"
            id="getzonechangefeeajax"
            url="{{getzonechangefeeurl}}"
            params="{{getzonechangefeeparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="getzonechangefeeResponse"
            debounce-duration="300"
            >
        </iron-ajax>
         <iron-ajax
            method="post"
            id="getzonechangetermdateajax"
            url="{{getzonechangetermdateurl}}"
            params="{{getzonechangetermdateparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="getzonechangetermdateResponse"
            debounce-duration="300"
            >
        </iron-ajax>
         <iron-ajax
            id="onewayajax"
            url="{{onewayurl}}"
            handle-as="json"
            content-type="application/json"
            on-response="onewayResponse"
            debounce-duration="300"
            >
        </iron-ajax>
        <iron-ajax
            id="onecusajax"
            url="{{onecusurl}}"
            handle-as="json"
            content-type="application/json"
            on-response="onecusResponse"
            debounce-duration="300"
            >
        </iron-ajax> 
         <iron-ajax
            method="post"
            id="setzonechangeajax"
            url="{{setzonechangeurl}}"
            params="{{setzonechangeparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="setzonechangeResponse"
            debounce-duration="300"
            >
        </iron-ajax>
         <iron-ajax
            method="post"
            id="previouszonedetailajax"
            url="{{previouszonedetailurl}}"
            params="{{previouszonedetailparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="previouszonedetailResponse"
            debounce-duration="300"
            >
        </iron-ajax>
         <iron-ajax
            method="post"
            id="getzonenamedetailajax"
            url="{{getzonenamedetailurl}}"
            params="{{getzonenamedetailparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="getzonenamedetailResponse"
            debounce-duration="300"
            >
        </iron-ajax>
         <iron-ajax
            method="post"
            id="deletepointajax"
            url="{{deletepointurl}}"
            params="{{deletepointparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="deletepointResponse"
            debounce-duration="300"
            > 
               <iron-ajax
            method="post"
            id="checkdelajax"
            url="{{checkdelurl}}"
            params="{{checkdelparam}}"
            handle-as="json"
            content-type="application/json"
            on-response="checkdelResponse"
            debounce-duration="300"
            >


        </iron-ajax>
        
  </template>

  <script>
  (function() {
     var yearlyfee;
     var totalfee;
     var val;
     var val1;
     var cusfee;
     var studentid;
     var zinstall1;
     var zinstall2;
     var zfee;
     var fromdate1;
     var todate1;
var startdate;
var currentdate;
var feemon;
var remainfee;
var mon;
var previouszone;
var prevzonefee;
var zid;
var zstuname;
    Polymer({
      is:'zonechange-service',
        getzonechangename:function()
      {
        this.getzonechangenameurl=sessionStorage.getItem("addrinfo")+"/getzonechangename";
        var obj={"schol":"","academic_year":""}
         obj.academic_year=localStorage.getItem("curr_sess_academicyear");
         obj.schol=sessionStorage.getItem("sch");
        this.getzonechangenameparam=obj;
       // alert(JSON.stringify(obj));
        this.$.getzonechangenameajax.generateRequest();
      },
       getzonechangenameResponse:function(e1)
      {
            var iditem=e1.detail.response.returnval;
           //       alert(JSON.stringify(e1.detail.response.returnval));
  
            document.querySelector('zonechange-card').autocompletearr(iditem);      
      },
      getzonechangestudetail:function(studid)
      {
        studentid=studid;

        this.fetchstuzonedetailurl=sessionStorage.getItem("addrinfo")+"/fetchstuzonedetail";
        var obj={"studid":"","schol":"","academic_year":""};

        obj.studid=studid;
        obj.academic_year=localStorage.getItem("curr_sess_academicyear");
        obj.schol=sessionStorage.getItem("sch");
        this.fetchstuzonedetailparam=obj;
        this.$.fetchstuzonedetailajax.generateRequest();
        this.getzonechangestudetailurl=sessionStorage.getItem("addrinfo")+"/getzonechangestudetail";
        var obj={"studid":"","schol":"","academic_year":""};
        obj.studid=studid;
        obj.schol=sessionStorage.getItem("sch");
        obj.academic_year=localStorage.getItem("curr_sess_academicyear");
        this.getzonechangestudetailparam=obj;
        this.$.getzonechangestudetailajax.generateRequest();
        this.zonechangeparentnameurl=sessionStorage.getItem("addrinfo")+"/getzonechangeparentname";
        this.zonechangeparentnameparam=obj;
        this.$.zonechangeparentdetailajax.generateRequest();
      },
      fetchstuzonedetailResponse:function(e)
      {
        //alert(JSON.stringify(e.detail.response.returnval[0]));
        previouszone=e.detail.response.returnval[0];
zinstall1=e.detail.response.returnval[0].installment_1;
zinstall2=e.detail.response.returnval[0].installment_2;
zfee=e.detail.response.returnval[0].fees;
zid=e.detail.response.returnval[0].zone_id;
 this.getzonenamedetailurl=sessionStorage.getItem("addrinfo")+"/getzonenamedetail";
        var obj={"zoneid":"","schol":"","academic_year":""};
         obj.zoneid=zid;
         obj.academic_year=localStorage.getItem("curr_sess_academicyear");
         obj.schol=sessionStorage.getItem("sch");
        this.getzonenamedetailparam=obj;
        this.$.getzonenamedetailajax.generateRequest();
    document.querySelector('zonechange-card').prevzonefee=zfee;
      },
      getzonenamedetailResponse:function(e)
      {
document.querySelector('zonechange-card').prevzone=e.detail.response.returnval[0].zone_name;
      },
      calculatedays:function(selectdate)
      {
 //  alert(fromdate1+''+selectdate);
 var startdate=new Date(fromdate1);
 var selectdat=new Date(selectdate);

 if(selectdat.getMonth()==startdate.getMonth())
 {
document.querySelector('zonechange-card').prevmonth=0;
document.querySelector('zonechange-card').prevusedfee=0;
remainfee=(parseInt(zinstall1)+parseInt(zinstall2));
document.querySelector('zonechange-card').prevremainfee=remainfee;
 }
 else
 {

              var monfee=(selectdat.getFullYear()-startdate.getFullYear())*12;
             mon-=startdate.getMonth()+1;
             mon+=selectdat.getMonth()+1;
             var mm=mon+2;
         //    alert(mm);
             document.querySelector('zonechange-card').prevmonth=mm;

             prevzonefee=(zfee/10);
             usedfee=prevzonefee*mm;
             mon=0;
              document.querySelector('zonechange-card').prevusedfee=usedfee;
             remainfee=(parseInt(zinstall1)+parseInt(zinstall2))-parseInt(usedfee);
             document.querySelector('zonechange-card').prevremainfee=remainfee;
           }
//alert(remainfee);
      },
      zonechangeparentnameResponse:function(e)
      {

        var parentname= e.detail.response.returnval[0].parent_name;
        document.querySelector('zonechange-card').parent=parentname;
      },
      getzonechangestudetailResponse:function(e1)
          {
            var profilename=e1.detail.response.returnval[0].student_name;
            var gradename=e1.detail.response.returnval[0].school_type;
            var dob=e1.detail.response.returnval[0].dob;
            var stdid=e1.detail.response.returnval[0].id;
            var classz=e1.detail.response.returnval[0].class_id;
            document.querySelector('zonechange-card').name=profilename;
            document.querySelector('zonechange-card').grade=gradename;
            document.querySelector('zonechange-card').date=dob;
            document.querySelector('zonechange-card').id=stdid;
            document.querySelector('zonechange-service').getzonechangetermdate(gradename);
            this.zonechangeclassurl=sessionStorage.getItem("addrinfo")+"/getzonechangeclass";
            var obj1={"class":"","schol":""}
            obj1.class=classz;
            obj1.schol=sessionStorage.getItem("sch");
            this.zonechangeclassparam=obj1;
            this.$.zonechangeclassajax.generateRequest();

      },
       zonechangeclassResponse:function(e){
        var stnd=e.detail.response.returnval[0].class;
        var secn=e.detail.response.returnval[0].section;
        document.querySelector('zonechange-card').stnd=stnd;
        document.querySelector('zonechange-card').secn=secn;
      },
       getchangezone:function()
      {
        this.getchangezoneurl=sessionStorage.getItem("addrinfo")+"/getchangezone";
     var obj={"schol":"","academic_year":""}
        obj.academic_year=localStorage.getItem("curr_sess_academicyear");
        obj.schol=sessionStorage.getItem("sch");
        this.getchangezoneparam=obj;
        this.$.getchangezoneajax.generateRequest();
      },
      getchangezoneResponse:function(e1)
          {  
            var zoneitem=e1.detail.response.returnval;
            document.querySelector('zonechange-card').itemarr=zoneitem;
         },
       getzonechangefee:function(zone)
        {
        this.getzonechangefeeurl = sessionStorage.getItem("addrinfo")+"/getzonechangefee";
        var obj={"zone":"","schol":"","academic_year":""}
        obj.zone=zone;
        obj.schol=sessionStorage.getItem("sch");
        obj.academic_year=localStorage.getItem("curr_sess_academicyear");
        this.getzonechangefeeparam=obj;
      //  alert(JSON.stringify(obj));
        this.$.getzonechangefeeajax.generateRequest();
      },
      getzonechangefeeResponse:function(e)
      {
       // alert(JSON.stringify(e.detail.response.returnval));

          totalfee=e.detail.response.returnval[0].fees;
        //  alert(totalfee);
          var actualfee=totalfee-remainfee;
          if(actualfee>0)
           {
          document.querySelector('zonechange-card').fee=actualfee;
        }
        else
        {
          document.querySelector('zonechange-card').fee=actualfee;
          //document.querySelector('zonechange-card').fee=totalfee;
        }
      },
       getzonechangetermdate:function(grade)
       {
         this.getzonechangetermdateurl=sessionStorage.getItem("addrinfo")+"/getzonechangetermdate";
         var obj={"grade":"","schol":"","academic_year":""}
            obj.academic_year=localStorage.getItem("curr_sess_academicyear");
     
         obj.schol=sessionStorage.getItem("sch");
         obj.grade=grade;
         this.getzonechangetermdateparam=obj;
        // alert(JSON.stringify(obj));
        this.$.getzonechangetermdateajax.generateRequest();
      },
       calc:function(values)
       {
      if(values=='foryear')
      {
        yearlyfee=totalfee;
        //alert(yearlyfee);
   }
      },
         getzonechangetermdateResponse:function(e1)
          {
       //   alert(JSON.stringify(e1.detail.response.returnval));
             fromdate1=e1.detail.response.returnval[0].start_date;
             todate1=e1.detail.response.returnval[0].end_date;
            document.querySelector('zonechange-card').zfromdate=fromdate1;
            document.querySelector('zonechange-card').ztodate=todate1;
            document.querySelector('zonechange-card').setzonedate(fromdate1,todate1);
             currentdate = new Date();
             startdate=new Date(fromdate1);
             mon=(currentdate.getFullYear()-startdate.getFullYear())*12;
             mon-=startdate.getMonth()+1;
             mon+=currentdate.getMonth();
             var m=mon+2;
             //alert(startdate);
             //alert(currentdate);
             feemon=parseInt((zfee/12)*m);
             remainfee=(parseInt(zinstall1)+parseInt(zinstall2))-parseInt(feemon);
             //alert('totalfee'+zfee);
             //alert('balance amount'+remainfee);
             //alert('used fee'+feemon);
      },
      oneway:function()
      {

        this.onewayurl="../../configfile/modeofway.json";
        this.$.onewayajax.generateRequest();


      },
      monthdiff:function(fromdate,todate){
        //alert('flow');
        var froms = fromdate;
        var to = todate;
        var d1 = new Date(froms);
        var d2=new Date(to);
        //alert('hi..'+d1+'   dvfa.. '+d2);
        months = (d2.getFullYear() - d1.getFullYear()) * 12;
        months -= d1.getMonth() + 1;
        months += d2.getMonth();
        var month = months+2;
        //alert(totalfee+'   '+month);
        cusfee = parseInt((totalfee/12)*month);
        //alert(cusfee);
      },
      onewayResponse:function(e){

          var temp=[];
          temp=e.detail.response;

          oneway=temp[0].oneway;

          val=(yearlyfee/100)*oneway;
//alert(val);
      document.querySelector('zonechange-card').fee=val;
      },
      onecus:function(){
           this.onecusurl="../../configfile/modeofway.json";
        this.$.onecusajax.generateRequest();
        },
      onecusResponse:function(e){
            var temp=[];
          temp=e.detail.response;

          oneway=temp[0].oneway;

              val=(cusfee/100)*oneway;
              val1=val-remainfee;
         document.querySelector('zonechange-card').fee=val1;

      },
      twoway:function(){
      val=yearlyfee;
      document.querySelector('zonechange-card').fee=val;
      },
      twocus:function(){
        val=cusfee;

          val1=val-remainfee;
        document.querySelector('zonechange-card').fee=val1;
      },
 setzonechange:function(studid,zone,fee,fromdatez,todatez,modez,namex,todayx,statusx,stuname)
      {
       
        var obj={"studid":"","zone":"","fee":"","fromdate":"","todate":"","mode":"","name":"","today":"","status":"","schol":"","academic_year":""};
        obj.schol=sessionStorage.getItem("sch");
        obj.studid=studid;
        obj.zone=zone;
        obj.fee=fee;
        obj.fromdate=fromdatez;
        obj.todate=todatez;
        obj.mode=modez;
        obj.name=namex;
        obj.today=todayx; 
        obj.academic_year=localStorage.getItem("curr_sess_academicyear");
        this.setzonechangeurl=sessionStorage.getItem("addrinfo")+"/setzonechange";
        obj.status=statusx;
        this.setzonechangeparam=obj;
        // alert(JSON.stringify(obj));
        this.$.setzonechangeajax.generateRequest();
        this.previouszonedetailurl = sessionStorage.getItem("addrinfo")+"/previouszonedetails";
        this.previouszonedetailparam=previouszone;
        this.$.previouszonedetailajax.generateRequest();
          zstuname=idz;
     
   },
      setzonechangeResponse:function()
      {
        alert('Zone Change Successfully');
       document.querySelector('zonechange-card').FnClear();
        this.deletepointurl = sessionStorage.getItem("addrinfo")+"/deletepoint";
         var obj={"studid":"","schol":"","academic_year":""}
         obj.studid=zstuname;
       //  alert(studentid);
         obj.academic_year=localStorage.getItem("curr_sess_academicyear");
         obj.schol=sessionStorage.getItem("sch");
         this.deletepointparam=obj;
         this.$.deletepointajax.generateRequest();

         this.checkdelurl = sessionStorage.getItem("addrinfo")+"/checkdel-service";
          this.checkdelparam=obj;
       //   alert(JSON.stringify(obj));
          this.$.checkdelajax.generateRequest();


      }

    });
  })();
  </script>
</dom-module>
